import e from"dayjs";import r from"dayjs/plugin/weekOfYear";import n from"dayjs/plugin/weekday";var a,t;e.extend(r),e.extend(n),function(e){e[e.Year=0]="Year",e[e.Month=1]="Month",e[e.Day=2]="Day",e[e.Hour=3]="Hour",e[e.Min=4]="Min",e[e.Sec=5]="Sec",e[e.WeekOfYear=6]="WeekOfYear",e[e.Weekday=7]="Weekday",e[e.WeekOfMonth=8]="WeekOfMonth"}(t||(t={}));var i=((a={})[t.Year]=void 0,a[t.Month]=[1,12],a[t.Day]=[1,31],a[t.Hour]=[0,23],a[t.Min]=[0,59],a[t.Sec]=[0,59],a[t.WeekOfYear]=[1,52],a[t.WeekOfMonth]=[1,4],a[t.Weekday]=[0,6],a);function u(e,r){return"*"===e?[]:e.split(",").map(function(e){var n=e.split("-"),a=n[1],t=parseInt(n[0]),u=parseInt(a);if(!function(e,r,n){if(isNaN(e)||isNaN(r))return!1;var a=i[n];return null==a||e>=a[0]&&r<=a[1]}(t,u,r))throw new Error("Invalid range "+t+"-"+u+" in");return{start:t,end:u}})}function o(e){var r=e.month,n=e.weekOfYear,a=e.weekOfMonth,i=e.weekday,o=e.day,s=e.hour,c=e.min,h=e.sec;return{period:e.period,year:u(e.year,t.Year),month:null!=r?u(r,t.Month):void 0,weekOfYear:null!=n?u(n,t.WeekOfYear):void 0,weekOfMonth:null!=a?u(a,t.WeekOfMonth):void 0,weekday:null!=i?u(i,t.Weekday):void 0,day:null!=o?u(o,t.Day):void 0,hour:u(s,t.Hour),min:u(c,t.Min),sec:u(h,t.Sec)}}function s(e,r,n,a){var i=a?n.start:n.end;switch(r){case t.Sec:return e.second(i);case t.Min:return e.minute(i);case t.Hour:return e.hour(i);case t.Day:return e.date(i);case t.Weekday:return e.weekday(i);case t.WeekOfMonth:var u=e.weekday();return e.startOf("month").week(i).weekday(u);case t.WeekOfYear:return e.week(i);case t.Month:return e.month(i);case t.Year:return e.year(i)}}function c(e,r){for(var n=0,a=!1,t=0;t<r.length;t++){n=t;var i=r[t],u=r[t-1];if(e>=i.start&&e<=i.end){a=!0;break}if(null!=u&&e>u.end&&e<i.start)break}return{rangeIndex:n,inRange:a}}function h(e,r,n,a,i,u){var o,c=n.weekOfMonth,h=n.day,f=a[i+1];if(null!=f)return s(r,e,f,u);switch(e){case t.Sec:o=t.Min;break;case t.Min:o=t.Hour;break;case t.Hour:o=null!=h?t.Day:t.Weekday;break;case t.Day:o=t.Month;break;case t.Weekday:o=null!=c?t.WeekOfMonth:t.WeekOfYear;break;case t.WeekOfMonth:case t.WeekOfYear:case t.Month:o=t.Year;break;case t.Year:return null}if(o){var k=d(o,r,n,u),l=u?a[0]:a[a.length-1];if(null!=k&&l)return s(k,e,l,u)}return null}function f(e,r){switch(r){case t.Sec:return e.second();case t.Min:return e.minute();case t.Hour:return e.hour();case t.Day:return e.date();case t.Weekday:return e.weekday();case t.WeekOfMonth:return parseInt(e.format("w"))-parseInt(e.startOf("M").format("w"))+1;case t.WeekOfYear:return e.week();case t.Month:return e.month();case t.Year:return e.year()}}function d(e,r,n,a){void 0===a&&(a=!0);var i=r,u=n.period,o=f(r,e),s=function(e,r){var n=e.year,a=e.month,i=e.weekOfYear,u=e.weekOfMonth,o=e.weekday,s=e.day,c=e.hour,h=e.min,f=e.sec;switch(r){case t.Sec:return f;case t.Min:return h;case t.Hour:return c;case t.Day:return s;case t.Weekday:return o;case t.WeekOfMonth:return u;case t.WeekOfYear:return i;case t.Month:return a;case t.Year:return n}}(n,e);if(s&&s.length){var d=c(o,s),k=d.rangeIndex;if(d.inRange){var l=function(e,r){var n,a,i=e.replace("P","").split("T"),u=i[0],o=i[1],s=void 0===o?"":o;switch(r){case t.Sec:n=s.match(/(\d+)[s]/i),a="second";break;case t.Min:n=s.match(/(\d+)[m]/i),a="minute";break;case t.Hour:n=s.match(/(\d+)[h]/i),a="hour";break;case t.Day:case t.Weekday:case t.WeekOfMonth:case t.WeekOfYear:n=u.match(/(\d+)[d]/i),a="day";break;case t.Month:n=u.match(/(\d+)[m]/i),a="month";break;case t.Year:n=u.match(/(\d+)[y]/i),a="year"}return n?{periodNumber:parseInt(n[1]),opUnit:a}:{periodNumber:NaN,opUnit:a}}(u,e),y=l.periodNumber,m=l.opUnit,p=c(f(i=a?r.add(y,m):r.subtract(y,m),e),s);p.inRange||(i=h(e,i,n,s,p.rangeIndex,a))}else i=h(e,r,n,s,k,a)}return i}var k=function(){function r(r,n){this.hasPrev=!0,this.hasNext=!0,this.options=r,this.originalTimestamp=n,this.currentTime=e.unix(n)}var n=r.prototype;return n.reset=function(){this.currentTime=e.unix(this.originalTimestamp)},n.prev=function(){if(!this.hasPrev)return null;var e=d(t.Sec,this.currentTime,this.options);return this.hasPrev=null!=e,null!=e&&(this.currentTime=e),e},n.next=function(){if(!this.hasNext)return null;var e=d(t.Sec,this.currentTime,this.options,!0);return this.hasNext=null!=e,null!=e&&(this.currentTime=e),e},r}();function l(e,r){var n,a=e.split(" ");if(function(e){return-1!==e.indexOf("/")}(e))if(function(e){return 5===e.length}(a)){var t=a[0],i=a[1],u=a[3],s=a[4],c=a[5],h=a[2].split("/");n=o({period:t,year:i,weekOfYear:h[0],weekday:h[1],hour:u,min:s,sec:c})}else{var f=a[0],d=a[1],l=a[2],y=a[4],m=a[5],p=a[6],v=a[3].split("/");n=o({period:f,year:d,month:l,weekOfMonth:v[0],weekday:v[1],hour:y,min:m,sec:p})}else{var M=e.split(" ");n=o({period:M[0],year:M[1],month:M[2],day:M[3],hour:M[4],min:M[5],sec:M[6]})}return new k(n,r)}export{l as parseExpression};
//# sourceMappingURL=index.ejs.map
